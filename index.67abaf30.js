!function(){function e(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function t(e,t){for(var l=0;l<t.length;l++){var n=t[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,l,n){return l&&t(e.prototype,l),n&&t(e,n),e}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,n=Array(t);l<t;l++)n[l]=e[l];return n}function i(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,void 0);var l=Object.prototype.toString.call(e).slice(8,-1);if("Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l)return Array.from(l);if("Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return n(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r=function(){function t(l,n,i){e(this,t);var r=document.createElement("div");r.classList.add("empty-cell"),l.append(r),this.x=n,this.y=i,this.element=r,this.linkedTile=null,this.linkedTileForMerge=null}return l(t,[{key:"linkTile",value:function(e){e.setXY(this.x,this.y),this.linkedTile=e}},{key:"unlinkedTile",value:function(){this.linkedTile=null}},{key:"isEmpty",value:function(){return!this.linkedTile}},{key:"linkTileForMerge",value:function(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}},{key:"unlinkTileForMerge",value:function(){this.linkedTileForMerge=null}},{key:"hasTileForMerge",value:function(){return!!this.linkedTileForMerge}},{key:"canAccept",value:function(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}},{key:"mergeTiles",value:function(){this.linkedTile.setValue(this.linkedTile.value+this.linkedTileForMerge.value),this.linkedTileForMerge.remove(),this.unlinkTileForMerge()}}]),t}(),s=function(){function t(l){e(this,t),this.element=document.createElement("div"),this.element.classList.add("full-cell"),this.setValue(.9>Math.random()?2:4),l.append(this.element)}return l(t,[{key:"setXY",value:function(e,t){this.x=e,this.y=t,this.element.style.setProperty("--x",e),this.element.style.setProperty("--y",t)}},{key:"setValue",value:function(e){this.value=e,this.element.textContent=this.value,this.element.classList.remove("full-cell--2","full-cell--4","full-cell--8","full-cell--16","full-cell--32","full-cell--64","full-cell--128","full-cell--256","full-cell--512","full-cell--1024","full-cell--2048"),this.element.classList.add("full-cell--".concat(e))}},{key:"remove",value:function(){this.element.remove()}}]),t}(),o=function(){function t(l){e(this,t),this.gridElement=l,this.cells=[],this.score=0,this.status="idle";for(var n=0;n<16;n++)this.cells.push(new r(l,n%4,Math.floor(n/4)));this.cellsGroupedByColumn=this.groupCellsByColumn(),this.cellsGroupedByReversedColumn=this.cellsGroupedByColumn.map(function(e){return i(e).reverse()}),this.cellsGroupedByRow=this.groupCellsByRow(),this.cellsGroupedByReversedRow=this.cellsGroupedByRow.map(function(e){return i(e).reverse()})}return l(t,[{key:"init",value:function(){this.createNewTile(),this.createNewTile(),this.status="playing"}},{key:"getRandomEmptyCell",value:function(){var e=this.cells.filter(function(e){return e.isEmpty()}),t=Math.floor(Math.random()*e.length);return e[t]}},{key:"groupCellsByColumn",value:function(){return this.cells.reduce(function(e,t){return e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e},[])}},{key:"groupCellsByRow",value:function(){return this.cells.reduce(function(e,t){return e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e},[])}},{key:"moveLeft",value:function(){this.slideTiles(this.cellsGroupedByRow),this.checkGameOver()}},{key:"moveRight",value:function(){this.slideTiles(this.cellsGroupedByReversedRow),this.checkGameOver()}},{key:"moveUp",value:function(){this.slideTiles(this.cellsGroupedByColumn),this.checkGameOver()}},{key:"moveDown",value:function(){this.slideTiles(this.cellsGroupedByReversedColumn),this.checkGameOver()}},{key:"slideTiles",value:function(e){var t=this;e.forEach(function(e){return t.slideTilesInGroup(e)}),this.cells.forEach(function(e){e.hasTileForMerge()&&e.mergeTiles()}),this.createNewTile(),this.updateScore()}},{key:"slideTilesInGroup",value:function(e){for(var t=1;t<e.length;t++)if(!e[t].isEmpty()){for(var l=e[t],n=void 0,i=t-1;i>=0&&e[i].canAccept(l.linkedTile);)n=e[i],i--;if(n){if(n.isEmpty())n.linkTile(l.linkedTile);else if(n.linkedTile.value===l.linkedTile.value){var r=2*n.linkedTile.value;this.score+=r,n.linkTileForMerge(l.linkedTile),l.unlinkedTile()}l.unlinkedTile()}}}},{key:"canMoveUp",value:function(){return this.canMove(this.cellsGroupedByColumn)}},{key:"canMoveDown",value:function(){return this.canMove(this.cellsGroupedByReversedColumn)}},{key:"canMoveLeft",value:function(){return this.canMove(this.cellsGroupedByRow)}},{key:"canMoveRight",value:function(){return this.canMove(this.cellsGroupedByReversedRow)}},{key:"canMove",value:function(e){var t=this;return e.some(function(e){return t.canMoveInGroup(e)})}},{key:"canMoveInGroup",value:function(e){return e.some(function(t,l){return!(0===l||t.isEmpty())&&e[l-1].canAccept(t.linkedTile)})}},{key:"getScore",value:function(){document.querySelector(".game-score").textContent=this.score}},{key:"getState",value:function(){return this.cells.map(function(e){return{x:e.x,y:e.y,value:e.linkedTile?e.linkedTile.value:null}})}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.score=0,this.updateScore(),this.clearGrid(),this.init(),this.status="playing",this.checkGameOver()}},{key:"updateScore",value:function(){var e=document.querySelector(".game-score");e&&(e.textContent=this.score)}},{key:"clearGrid",value:function(){document.querySelectorAll(".full-cell").forEach(function(e){return e.remove()}),this.cells.forEach(function(e){e.linkedTile=null,e.linkedTileForMerge=null})}},{key:"createNewTile",value:function(){var e=this.getRandomEmptyCell();if(e){var t=new s(this.gridElement);e.linkTile(t),t.setXY(e.x,e.y)}}},{key:"restart",value:function(){this.clearGrid(),this.score=0,this.updateScore(),this.status="playing"}},{key:"checkForWin",value:function(){return void 0!==this.cells.find(function(e){return e.linkedTile&&2048===e.linkedTile.value})}},{key:"checkGameOver",value:function(){if(!this.canMoveUp()&&!this.canMoveDown()&&!this.canMoveLeft()&&!this.canMoveRight()){var e=document.querySelector("p.message-lose");this.status="lose",e.classList.remove("hidden")}}}]),t}(),u=document.querySelector(".game-field"),c=document.querySelector("p.message-start"),a=document.querySelector("p.message-win"),h=document.querySelector("p.message-lose"),d=new o(u),v=document.querySelector(".button.start"),f=document.querySelector(".button.restart");function y(){window.addEventListener("keydown",m,{once:!0})}function m(e){switch(e.key){case"ArrowLeft":d.canMoveLeft()&&d.moveLeft();break;case"ArrowRight":d.canMoveRight()&&d.moveRight();break;case"ArrowUp":d.canMoveUp()&&d.moveUp();break;case"ArrowDown":d.canMoveDown()&&d.moveDown();break;default:y();return}d.checkForWin()&&a.classList.remove("hidden"),y()}v.addEventListener("click",function(){d.start(),c.classList.add("hidden"),h.classList.add("hidden"),a.classList.add("hidden"),v.style.display="none",f.style.display="block"}),f.addEventListener("click",function(){d.restart(),v.textContent="Start",v.classList.remove("restart"),v.classList.add("start"),c.classList.remove("hidden"),h.classList.add("hidden"),v.style.display="block",f.style.display="none"}),y()}();
//# sourceMappingURL=index.67abaf30.js.map
