class e{constructor(e,l,t){let s=document.createElement("div");s.classList.add("empty-cell"),e.append(s),this.x=l,this.y=t,this.element=s,this.linkedTile=null,this.linkedTileForMerge=null}linkTile(e){e.setXY(this.x,this.y),this.linkedTile=e}unlinkedTile(){this.linkedTile=null}isEmpty(){return!this.linkedTile}linkTileForMerge(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}unlinkTileForMerge(){this.linkedTileForMerge=null}hasTileForMerge(){return!!this.linkedTileForMerge}canAccept(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}mergeTiles(){this.linkedTile.setValue(this.linkedTile.value+this.linkedTileForMerge.value),this.linkedTileForMerge.remove(),this.unlinkTileForMerge()}}class l{constructor(e){this.element=document.createElement("div"),this.element.classList.add("full-cell"),this.setValue(.9>Math.random()?2:4),e.append(this.element)}setXY(e,l){this.x=e,this.y=l,this.element.style.setProperty("--x",e),this.element.style.setProperty("--y",l)}setValue(e){this.value=e,this.element.textContent=this.value,this.element.classList.remove("full-cell--2","full-cell--4","full-cell--8","full-cell--16","full-cell--32","full-cell--64","full-cell--128","full-cell--256","full-cell--512","full-cell--1024","full-cell--2048"),this.element.classList.add(`full-cell--${e}`)}remove(){this.element.remove()}}const t=document.querySelector(".game-field"),s=document.querySelector("p.message-start"),i=document.querySelector("p.message-win"),r=document.querySelector("p.message-lose"),n=new class{constructor(l){this.gridElement=l,this.cells=[],this.score=0,this.status="idle";for(let t=0;t<16;t++)this.cells.push(new e(l,t%4,Math.floor(t/4)));this.cellsGroupedByColumn=this.groupCellsByColumn(),this.cellsGroupedByReversedColumn=this.cellsGroupedByColumn.map(e=>[...e].reverse()),this.cellsGroupedByRow=this.groupCellsByRow(),this.cellsGroupedByReversedRow=this.cellsGroupedByRow.map(e=>[...e].reverse())}init(){this.createNewTile(),this.createNewTile(),this.status="playing"}getRandomEmptyCell(){let e=this.cells.filter(e=>e.isEmpty()),l=Math.floor(Math.random()*e.length);return e[l]}groupCellsByColumn(){return this.cells.reduce((e,l)=>(e[l.x]=e[l.x]||[],e[l.x][l.y]=l,e),[])}groupCellsByRow(){return this.cells.reduce((e,l)=>(e[l.y]=e[l.y]||[],e[l.y][l.x]=l,e),[])}moveLeft(){this.slideTiles(this.cellsGroupedByRow),this.checkGameOver()}moveRight(){this.slideTiles(this.cellsGroupedByReversedRow),this.checkGameOver()}moveUp(){this.slideTiles(this.cellsGroupedByColumn),this.checkGameOver()}moveDown(){this.slideTiles(this.cellsGroupedByReversedColumn),this.checkGameOver()}slideTiles(e){e.forEach(e=>this.slideTilesInGroup(e)),this.cells.forEach(e=>{e.hasTileForMerge()&&e.mergeTiles()}),this.createNewTile(),this.updateScore()}slideTilesInGroup(e){for(let l=1;l<e.length;l++){let t;if(e[l].isEmpty())continue;let s=e[l],i=l-1;for(;i>=0&&e[i].canAccept(s.linkedTile);)t=e[i],i--;if(t){if(t.isEmpty())t.linkTile(s.linkedTile);else if(t.linkedTile.value===s.linkedTile.value){let e=2*t.linkedTile.value;this.score+=e,t.linkTileForMerge(s.linkedTile),s.unlinkedTile()}s.unlinkedTile()}}}canMoveUp(){return this.canMove(this.cellsGroupedByColumn)}canMoveDown(){return this.canMove(this.cellsGroupedByReversedColumn)}canMoveLeft(){return this.canMove(this.cellsGroupedByRow)}canMoveRight(){return this.canMove(this.cellsGroupedByReversedRow)}canMove(e){return e.some(e=>this.canMoveInGroup(e))}canMoveInGroup(e){return e.some((l,t)=>!(0===t||l.isEmpty())&&e[t-1].canAccept(l.linkedTile))}getScore(){document.querySelector(".game-score").textContent=this.score}getState(){return this.cells.map(e=>({x:e.x,y:e.y,value:e.linkedTile?e.linkedTile.value:null}))}getStatus(){return this.status}start(){this.score=0,this.updateScore(),this.clearGrid(),this.init(),this.status="playing",this.checkGameOver()}updateScore(){let e=document.querySelector(".game-score");e&&(e.textContent=this.score)}clearGrid(){document.querySelectorAll(".full-cell").forEach(e=>e.remove()),this.cells.forEach(e=>{e.linkedTile=null,e.linkedTileForMerge=null})}createNewTile(){let e=this.getRandomEmptyCell();if(e){let t=new l(this.gridElement);e.linkTile(t),t.setXY(e.x,e.y)}}restart(){this.clearGrid(),this.score=0,this.updateScore(),this.status="playing"}checkForWin(){return void 0!==this.cells.find(e=>e.linkedTile&&2048===e.linkedTile.value)}checkGameOver(){if(!this.canMoveUp()&&!this.canMoveDown()&&!this.canMoveLeft()&&!this.canMoveRight()){let e=document.querySelector("p.message-lose");this.status="lose",e.classList.remove("hidden")}}}(t),o=document.querySelector(".button.start"),c=document.querySelector(".button.restart");function a(){window.addEventListener("keydown",h,{once:!0})}function h(e){switch(e.key){case"ArrowLeft":n.canMoveLeft()&&n.moveLeft();break;case"ArrowRight":n.canMoveRight()&&n.moveRight();break;case"ArrowUp":n.canMoveUp()&&n.moveUp();break;case"ArrowDown":n.canMoveDown()&&n.moveDown();break;default:a();return}n.checkForWin()&&i.classList.remove("hidden"),a()}o.addEventListener("click",()=>{n.start(),s.classList.add("hidden"),r.classList.add("hidden"),i.classList.add("hidden"),o.style.display="none",c.style.display="block"}),c.addEventListener("click",()=>{n.restart(),o.textContent="Start",o.classList.remove("restart"),o.classList.add("start"),s.classList.remove("hidden"),r.classList.add("hidden"),o.style.display="block",c.style.display="none"}),a();
//# sourceMappingURL=index.20993452.js.map
